{% extends 'logisticsBase.html' %}{% block localhead %}    <div class="panel panel-primary">        <div class="panel-heading">            <h3 class="panel-title">查询条件</h3>        </div>        <div class="panel-body">            <form id="formSearch" class="form-horizontal" role="form" id="serach_form">                <div class="form-group">                    <label class="control-label col-sm-2" for="txt_search_stuclasslabel">角色</label>                    <div class="col-sm-2">                        <select class="form-control" id="role_id">                            <option value="0">全部</option>                            {% for mi in menu_info %}                                <option value="{{ mi.id }}">{{ mi.name }}</option>                            {% endfor %}                        </select>                    </div>                    <label class="control-label col-sm-1" for="txt_search_stuclasslabel">用户名</label>                    <div class="col-sm-2">                        <input type="text" class="form-control" id="u_name" name="u_name">                    </div>                    <label class="control-label col-sm-1" for="txt_search_stuidlabel">中文名</label>                    <div class="col-sm-2">                        <input type="text" class="form-control" id="chinese_name">                    </div>                    <div class="col-sm-2" style="text-align:left;">                        <a class="btn btn-primary" onclick="mytable_refesh()">查询</a>                    </div>                </div>            </form>        </div>    </div>    <!-- bstable的工具栏钮-->    <div id="toolbar" class="btn-group">        <a class="btn btn-primary" id="btn_add" href="{% url 'sm:userAdd' %}" data-toggle="modal">            <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>添加        </a>        <a class="btn btn-primary" href="{% url 'sm:userInfoExport' %}"> <span class="glyphicon glyphicon-remove"                                                                                aria-hidden="true"></span>导出</a>    </div>    <!-- 货物信息表单-->    <div class="panel panel-primary">        <div class="panel-heading">            <h3 class="panel-title">登录用户信息</h3>        </div>        <div class="panel-body">            <table id="my_table"></table>        </div>    </div>    <script>        //主要包括这几个方法：        //1.页面加载时：加载boostrapt table，并将数据传给后台        //2.设置搜索框产生变化时对boostrapt table进行刷新        //3.设置boostrapt table中的自定义按钮：增删改查        $(function () {            addTable(); //初始化表格        })        function mytable_refesh() {            $("#my_table").bootstrapTable('refresh');        }        //table加载        function addTable () {            $("#my_table").bootstrapTable({                toolbar: '#toolbar',                //工具按钮用哪个容器                striped: true,                      //是否显示行间隔色                cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）                pagination: true,                   //是否显示分页（*）                sortable: true,                     //是否启用排序                sortName: 'id',                     // 要排序的字段                sortOrder: "asc",                   //排序方式                sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）                pageNumber: 1,                       //初始化加载第一页，默认第一页                pageSize: 10,                       //每页的记录行数（*）                pageList: [10, 20, 30, 50, 100],     //可供选择的每页的行数（*）                paginationPreText: "上一页",                paginationNextText: "下一页",                clickToSelect: true,                search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大                //strictSearch: true,                showColumns: true,                  //是否显示所有的列                showRefresh: true,                  //是否显示刷新按钮                minimumCountColumns: 2,             //最少允许的列数                clickToSelect: true,                //是否启用点击选中行                //height: 700,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度                uniqueId: "id",                     //每一行的唯一标识，一般为主键列                showToggle: true,                    //是否显示详细视图和列表视图的切换按钮                cardView: false,                    //是否显示详细视图                detailView: false,                   //是否显示父子表                contentType: "application/x-www-form-urlencoded; charset=UTF-8",                url: "/sm/getUserInfo/",          //请求后台的URL（*）                method: "GET",                      //请求方式（*）                //queryParams: "queryParams",         //传递参数（*）                queryParamsType: "",                queryParams: function (params) {                    temp = {                        spmc_id: "none",                        offset: params.offset,                        limit: params.limit,                        sort: params.sort,                        order: params.order,                        pageNumber: params.pageNumber,                        pageSize: params.pageSize,                        search: params.search,                        role_id: $("#role_id").val(),                        u_name: $("#u_name").val(),                        chinese_name: $("#chinese_name").val(),                    };                    return temp;                },                //showExport: true,                //exportDataType: 'all',                //exportTypes:[ 'csv', 'doc', 'excel', 'xlsx', 'pdf'],  //导出文件类型                columns: [{                    checkbox: true                }, {                    field: 'id',                    title: 'id',                }, {                    field: 'u_name',                    title: '用户名',                }, {                    field: 'u_status_tsc',                    title: '账号状态',                }, {                    field: 'chinese_name',                    title: '中文名称'                }, {                    field: 'identity_card',                    title: '身份证号',                }, {                    field: 'telephone_number',                    title: '手机号',                }, {                    field: 'wechanumber',                    title: '微信号',                }, {                    field: 'email',                    title: '邮箱',                }, {                    field: 'lastlogin_date',                    title: '最后登录时间',                }, {                    field: 'system_role',                    title: '角色',                }, {                    field: 'action',                    title: '操作',                    formatter: "actionFormatter",                }]            });        }        //操作按钮        function actionFormatter(value, row, index) {            return [                '<a class="btn btn-info btn-sm" id="btnedit" href="/sm/userEdit?id=' + row.id + '">编辑</a>',                '<a class="btn btn-danger btn-sm" id="btndel" href="#" onclick="userDelById(' + row.id + ')">冻结</a>',            ].join('');        }        //点击删除按钮触发的提示确认框        function userDelById(id) {            BootstrapDialog.show({                title: '信息提示',                message: '确定冻结该用户?',                buttons: [{                    label: '确定',                    action: function (dialogItself) {                        dialogItself.close();                        var ajaxdata = {                            id: id                        };                        $.ajax({                            url: "/sm/userDelById",                            type: "GET",                            data: ajaxdata,                            success: function (data) {                                result_info = JSON.parse(data);                                ret_code = result_info.ret_code                                ret_info = result_info.ret_info                                BootstrapDialog.show({                                    title: '信息提示',                                    message: ret_info,                                    buttons: [{                                        label: '关闭',                                        action: function (dialogItself) {                                            $(location).attr('href', '/sm/userManage');                                            dialogItself.close();                                        }                                    }]                                });                            }                        })                    }                }, {                    label: '取消',                    action: function (dialogItself) {                        dialogItself.close();                    }                }]            });        }        //导出按钮点击事件        function exportData() {            BootstrapDialog.show({                title: '下载提示',                message: '是否下载仓库信息表?',                buttons: [{                    label: '确定',                    action: function (dialogItself) {                        dialogItself.close();                        $('#tb_warehouse').tableExport({                            type: 'excel',                            exportDataType: "all",                            ignoreColumn: [0],//忽略某一列的索引                            fileName: '仓库信息表',//下载文件名称                            onCellHtmlData: function (cell, row, col, data) {//处理导出内容,自定义某一行、某一列、某个单元格的内容                                console.info(data);                                return data;                            },                        });                    }                }, {                    label: '取消',                    action: function (dialogItself) {                        dialogItself.close();                    }                }]            });        }    </script>{% endblock %}