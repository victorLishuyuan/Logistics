{% extends 'logisticsBase.html' %}{% load static %}{% block localhead %}    <link rel="stylesheet" href="{% static 'zTree/css/demo.css' %}">    <link rel="stylesheet" href="{% static 'zTree/css/zTreeStyle/zTreeStyle.css' %}">    <script type="text/javascript" src="{% static 'zTree/js/jquery.ztree.core.js' %}"></script>    <script type="text/javascript" src="{% static 'zTree/js/jquery.ztree.excheck.js' %}"></script>{% endblock %}{% block localbody %}    <div class="col-md-12" style="width: 40%">        <h1 class="page-header" style="font-size: 14px ; text-align: center">            <div class="panel panel-primary">                <div class="panel-heading">                    <h3 class="panel-title">角色添加</h3>                </div>                <div class="panel-body">                    <form class="form-horizontal group-border hover-stripped" method="post"                          enctype="multipart/form-data" action="{% url 'sm:roleEdit' rid %}">                        {% csrf_token %}                        <input id="rid" value="{{ rid }}" hidden> <!--设置隐藏输入，用来给js提供参数（角色id）-->                        <div class="form-group">                            <label class="col-lg-3 col-md-4 col-sm-12 control-label">角色名:</label>                            <div class="col-lg-8 col-md-4 col-sm-12">                                <input name="r_name" value="{{ role_info.name }}" type="text" class="form-control"                                       placeholder="角色名" autofocus="autofocus">                            </div>                        </div>                        <div class="form-group">                            <label class="col-lg-3 col-md-4 col-sm-12 control-label">备注:</label>                            <div class="col-lg-8 col-md-4 col-sm-12">                                <input name="note" value="{{ role_info.note }}" type="text" class="form-control"                                       placeholder="备注" autofocus="autofocus">                            </div>                        </div>                        <div class="form-group">                            <label class="col-lg-3 col-md-4 col-sm-12 control-label">权限信息:</label>                            <div class="col-lg-8 col-md-4 col-sm-12">                                <ul id="treeDemo" class="ztree"></ul>   <!--用的zTree控件，用来显示树形多选框-->                                <input id="menuCodeList" type="text" name="menuCodeList" hidden>                                <!--设置一个隐藏域，用来存放通过树形多选框选择完的id值-->                            </div>                        </div>                        <button type="submit" class="btn btn-primary" onclick="setMenuCodeList()">保存                        </button>                        <a class="btn btn-danger" href="{% url 'sm:roleManage' %}">返回</a>                    </form>                </div>            </div>        </h1>    </div>    <script type="text/javascript">        var setting = {            view: {showLine: true, showIcon: false}, //有没有连线和显不示显示图标            check: {                enable: true,                chkboxType: {"Y": "ps", "N": "ps"}            },            data: {                simpleData: {                    enable: true                }            }        };        var zNodes = [];        {# 查询menu的信息#}        $(function () {            var rid = $("#rid").val(); //给超链接提供参数            $.ajax({                url: '/sm/getMenu',                async: true,//同步方式发送请求，true为异步发送                type: "POST",                headers: {"X-CSRFToken": $.cookie('csrftoken')},                data: {                    'rid': rid       //将角色的id传到后台                },                success: function (result) {                    menu_list = JSON.parse(result);                    zNodes.length = 0;                    for (var i = 0; i < menu_list.length; i++) {                        var obj = new Object();                        obj.id = menu_list[i].id                        obj.pId = menu_list[i].pId                        obj.name = menu_list[i].name                        obj.open = menu_list[i].open                        obj.checked = menu_list[i].checked                        zNodes.push(obj)                    }                    $.fn.zTree.init($("#treeDemo"), setting, zNodes);                }            });        });        function setMenuCodeList() {            var treeObj = $.fn.zTree.getZTreeObj("treeDemo");            var nodes = treeObj.getCheckedNodes();            menuCodeList = '';            for (var i = 0; i < nodes.length; i++) {                menuCodeList += nodes[i].id;                if (i != nodes.length - 1)                    menuCodeList += ',';            }            $("#menuCodeList").val(menuCodeList);        }    </script>{% endblock %}