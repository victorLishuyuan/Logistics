{% extends 'logisticsBase.html' %}{% load static %}{% block localhead %}        <!--树状插件-->        <link rel="stylesheet" href="{% static 'zTree/css/demo.css' %}">        <link rel="stylesheet" href="{% static 'zTree/css/zTreeStyle/zTreeStyle.css' %}">        <script type="text/javascript" src="{% static 'zTree/js/jquery.ztree.core.js' %}"></script>        <script type="text/javascript" src="{% static 'zTree/js/jquery.ztree.excheck.js' %}"></script>{% endblock %}{% block localbody %}    <div class="col-md-12" style="width: 40%">        <h1 class="page-header" style="font-size: 14px ; text-align: center">            <div class="panel panel-primary">                <div class="panel-heading">                    <h3 class="panel-title">角色添加</h3>                </div>                <div class="panel-body">                    <form class="form-horizontal group-border hover-stripped" method="post"                          enctype="multipart/form-data" action="{% url 'sm:roleAdd' %}">                        {% csrf_token %}                        <div class="form-group">                            <label class="col-lg-3 col-md-4 col-sm-12 control-label">角色名:</label>                            <div class="col-lg-8 col-md-4 col-sm-12">                                <input name="r_name" type="text" class="form-control"                                       placeholder="角色名" autofocus="autofocus">                            </div>                        </div>                        <div class="form-group">                            <label class="col-lg-3 col-md-4 col-sm-12 control-label">备注:</label>                            <div class="col-lg-8 col-md-4 col-sm-12">                                <input name="note" type="text" class="form-control"                                       placeholder="备注" autofocus="autofocus">                            </div>                        </div>                        <div class="form-group">                            <label class="col-lg-3 col-md-4 col-sm-12 control-label">权限信息:</label>                            <div class="col-lg-8 col-md-4 col-sm-12">                                <ul id="treeDemo" class="ztree"></ul>                                <input id="menuCodeList" type="text"  name="menuCodeList" hidden>                            </div>                        </div>                        <button type="submit" class="btn btn-primary" onclick="setMenuCodeList()">保存</button>                         <a class="btn btn-danger" href="{% url 'sm:roleManage' %}">返回</a>                    </form>                </div>            </div>        </h1>    </div>    <script type="text/javascript">        {#var zNodes = [#}        {#{id: 1, pId: 0, name: "随意勾选 1", open: true},#}        {#{id: 11, pId: 1, name: "随意勾选 1-1", open: true},#}        {#{id: 105, pId: 11, name: "105"},#}        {#{id: 112, pId: 11, name: "随意勾选 1-1-2"},#}        {#{id: 12, pId: 1, name: "随意勾选 1-2", open: true},#}        {#{id: 121, pId: 12, name: "随意勾选 1-2-1"},#}        {#{id: 122, pId: 12, name: "随意勾选 1-2-2"},#}        {#{id: 2, pId: 0, name: "随意勾选 2", checked: true, open: true},#}        {#{id: 21, pId: 2, name: "随意勾选 2-1"},#}        {#{id: 22, pId: 2, name: "随意勾选 2-2", open: true},#}        {#{id: 221, pId: 22, name: "随意勾选 2-2-1", checked: true},#}        {#{id: 222, pId: 22, name: "随意勾选 2-2-2"},#}        {#{id: 23, pId: 2, name: "随意勾选 2-3"}#}        {#];#}        var setting = {            view: {showLine: true, showIcon: false}, //有没有连线和显不示显示图标            check: {                enable: true,                chkboxType: {"Y": "ps", "N": "ps"}            },            data: {                simpleData: {                    enable: true                }            }        };        var zNodes = [];        {# 查询menu的信息#}        $(function () {            $.ajax({                url: '/sm/getMenu',                async: true,//同步方式发送请求，true为异步发送                type: "POST",                headers: {"X-CSRFToken": $.cookie('csrftoken')},                data: {},                success: function (result) {                    menu_list = JSON.parse(result);                    zNodes.length = 0;                    for (var i = 0; i < menu_list.length; i++) {                        var obj = new Object();                        obj.id = menu_list[i].id                        obj.pId = menu_list[i].pId                        obj.name = menu_list[i].name                        obj.open =  menu_list[i].open                        obj.checked = menu_list[i].checked                        zNodes.push(obj)                        {#zNodes[i] = {id: menu_list[i].id, pId: menu_list[i].pId, name: menu_list[i].name, open: true};#}                    }                    $.fn.zTree.init($("#treeDemo"), setting, zNodes);                }            });        });        function setMenuCodeList() {            var treeObj = $.fn.zTree.getZTreeObj("treeDemo");            var nodes = treeObj.getCheckedNodes();            menuCodeList = '';            for(var i=0;i<nodes.length ; i++){                   menuCodeList += nodes[i].id;                   if(i!=nodes.length-1)                       menuCodeList += ',';            }            $("#menuCodeList").val(menuCodeList);        }    </script>{% endblock %}